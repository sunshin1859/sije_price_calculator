<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIJE êµ¬ë…ë£Œ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Pretendard Variable', sans-serif;
      max-width: 1400px;
      margin: 20px auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 40px;
      border: 1px solid #ccc;
    }
    .flex-row {
      display: flex;
      gap: 40px;
    }
    .form-section {
      flex: 1;
    }
    .result {
      flex: 2;
      background: #f9f9f9;
      padding: 10px;
      border: 1px solid #ddd;
      overflow-x: auto;
    }
    label { display: block; margin-top: 10px; }
    input[type="text"], input[type="number"], select { width: 100%; padding: 4px; margin-top: 4px; }
    .saved-list { margin-top: 10px; font-size: 0.9em; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background-color: #f0f0f0; }
    .highlight { background-color: #e3f7d9; font-weight: bold; }
    canvas { margin-top: 20px; }
    .remark-box {
      background: #fffdf0;
      border: 1px dashed #bbb;
      padding: 10px;
      font-size: 0.9em;
      line-height: 1.6em;
    }
    .remark-details {
      margin-top: 8px;
      font-size: 0.85em;
      color: #444;
    }
    .service-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 0.85em;
    }
    .service-table th, .service-table td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
    }
    .service-table th {
      background-color: #f5f5f5;
    }
    button {
      padding: 8px 16px;
      margin-top: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .comparison-table th, .comparison-table td {
      padding: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="flex-row">
    <div class="form-section">
      <h1>SIJE êµ¬ë…ë£Œ ê³„ì‚°ê¸°</h1>
      <label>íšŒì‚¬ëª…
        <input type="text" id="companyName" placeholder="íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
      </label>
      <label>íšŒì‚¬ êµ¬ë¶„
        <select id="companyType">
          <option value="">ì„ íƒ</option>
          <option value="production">ìƒì‚° ì¤‘ì‹¬</option>
          <option value="sourcing">ì†Œì‹± ì¤‘ì‹¬</option>
          <option value="data">ë°ì´í„° ì¤‘ì‹¬</option>
        </select>
      </label>
      <label>ì¬ë´‰í‹€ ìˆ˜
        <input type="number" id="machines" value="0" min="0">
      </label>
      <label>ì‚¬ìš©ì ìˆ˜ (Monolis)
        <input type="number" id="users" value="0" min="0">
      </label>
      <button id="simulateBtn">ìƒì„¸ ì‹œë®¬ë ˆì´ì…˜</button>
      <button id="saveBtn">ì‹œë®¬ë ˆì´ì…˜ ì €ì¥</button>

      <div class="saved-list">
        <h4>ğŸ“‚ ì €ì¥ëœ ì‹œë®¬ë ˆì´ì…˜ ë³´ê¸°</h4>
        <ul id="savedSimulations"></ul>
      </div>

      <div class="remark-box">
        <strong>ğŸ“Œ ê°€ê²© ì •ì±…</strong>
        <table class="service-table">
          <tr>
            <th>ì„œë¹„ìŠ¤</th>
            <th>ì„¤ì¹˜ë¹„</th>
            <th>êµ¬ë…ë£Œ</th>
          </tr>
          <tr>
            <td>Monolog</td>
            <td>$100/ì¬ë´‰í‹€ (ì¼íšŒì„±)</td>
            <td>$1,100/120ëŒ€ (ì›”)</td>
          </tr>
          <tr>
            <td>Monolis</td>
            <td>$0</td>
            <td>$40/1ì¸ (ì›”)</td>
          </tr>
          <tr>
            <td>MoAI</td>
            <td>$0</td>
            <td>Monolog êµ¬ë…ë£Œì˜ 2ë°°</td>
          </tr>
        </table>
      </div>
    </div>
    <div class="result" id="result"></div>
  </div>

  <div class="result">
    <h2>ë¹„êµ ë¶„ì„</h2>
    <label>ë¹„êµí•  íšŒì‚¬ ì„ íƒ (ìµœëŒ€ 5ê°œ)
      <select id="compareSelect" multiple style="height: 120px; width: 100%;"></select>
    </label>
    <button id="compareBtn">ë¹„êµ ë¶„ì„ ì‹¤í–‰</button>
    <div id="comparisonResult"></div>
    <canvas id="comparisonChart" width="800" height="400"></canvas>
  </div>

  <script>
    // ì €ì¥ëœ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°
    let savedSimulations = JSON.parse(localStorage.getItem('sijeSimulations')) || [];
    let currentSimulation = null;
    let comparisonChart = null;

    // ê°€ê²© ì •ì±… (USD ê¸°ì¤€)
    const PRICES = {
      monolog: {
        installation: 100, // ì¬ë´‰í‹€ 1ëŒ€ë‹¹
        subscription: 1100 // 120ëŒ€ë‹¹ ì›” êµ¬ë…ë£Œ
      },
      monolis: {
        installation: 0,
        subscription: 40 // 1ì¸ë‹¹ ì›” êµ¬ë…ë£Œ
      },
      moai: {
        installation: 0,
        subscriptionMultiplier: 2 // Monolog êµ¬ë…ë£Œì˜ 2ë°°
      },
      pocFee: 15000 // PoC ì§„í–‰ë¹„ìš©
    };

    // DOM ìš”ì†Œ
    const simulateBtn = document.getElementById("simulateBtn");
    const saveBtn = document.getElementById("saveBtn");
    const compareBtn = document.getElementById("compareBtn");
    const savedSimulationsList = document.getElementById("savedSimulations");
    const compareSelect = document.getElementById("compareSelect");

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    simulateBtn.addEventListener("click", simulateDetails);
    saveBtn.addEventListener("click", saveSimulation);
    compareBtn.addEventListener("click", showComparison);

    // ì´ˆê¸°í™”
    updateSavedSimulationsList();

    // í†µí™” í˜•ì‹ (ë‹¬ëŸ¬)
    function formatCurrency(amount) {
      return amount ? '$' + amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '-';
    }

    // êµ¬ë…ë£Œ ê³„ì‚° (2024 ìµœì‹  ë²„ì „)
    function calculateSubscription(companyType, machines, users) {
      const result = { years: [] };

      for (let year = 1; year <= 4; year++) {
        const phase = year === 1 ? 'Acquire' : (year <= 3 ? 'Expand' : 'Standardize');
        const ratio = year === 1 ? 0.05 : (year <= 3 ? 0.2 : 0.7);

        let yearData = {
          year,
          phase,
          monolog: { installation: 0, subscription: 0 },
          monolis: { installation: 0, subscription: 0 },
          moai: { installation: 0, subscription: 0 },
          poc: 0,
          total: 0
        };

        // PoC ë¹„ìš© (1ë…„ì°¨ë§Œ ì ìš©)
        if (year === 1) {
          yearData.poc = PRICES.pocFee;
        }

        // ìƒì‚° ì¤‘ì‹¬
        if (companyType === "production") {
          if (year >= 1) {
            // Monolog
            const monologMachines = Math.ceil(machines * ratio);
            yearData.monolog.installation = monologMachines * PRICES.monolog.installation;
            yearData.monolog.subscription = Math.ceil(monologMachines / 120) * PRICES.monolog.subscription;
            
            // MoAI (2ë…„ì°¨ë¶€í„°)
            if (year >= 2) {
              yearData.moai.subscription = yearData.monolog.subscription * PRICES.moai.subscriptionMultiplier;
            }
            
            // Monolis (3ë…„ì°¨ë¶€í„°)
            if (year >= 3) {
              const monolisUsers = Math.ceil(users * ratio);
              yearData.monolis.subscription = monolisUsers * PRICES.monolis.subscription;
            }
          }
        }
        // ì†Œì‹± ì¤‘ì‹¬
        else if (companyType === "sourcing") {
          // Monolis (1ë…„ì°¨)
          if (year === 1) {
            const monolisUsers = Math.ceil(users * ratio);
            yearData.monolis.subscription = monolisUsers * PRICES.monolis.subscription;
          }
          // 2ë…„ì°¨ ì´í›„
          else if (year >= 2) {
            const monologMachines = Math.ceil(machines * ratio);
            yearData.monolog.installation = monologMachines * PRICES.monolog.installation;
            yearData.monolog.subscription = Math.ceil(monologMachines / 120) * PRICES.monolog.subscription;
            
            const monolisUsers = Math.ceil(users * ratio);
            yearData.monolis.subscription = monolisUsers * PRICES.monolis.subscription;
            
            yearData.moai.subscription = yearData.monolog.subscription * PRICES.moai.subscriptionMultiplier;
          }
        }
        // ë°ì´í„° ì¤‘ì‹¬
        else if (companyType === "data") {
          // MoAI (1ë…„ì°¨)
          if (year === 1) {
            const monologMachines = Math.ceil(machines * ratio);
            const monologSub = Math.ceil(monologMachines / 120) * PRICES.monolog.subscription;
            yearData.moai.subscription = monologSub * PRICES.moai.subscriptionMultiplier;
          }
          // 2ë…„ì°¨ ì´í›„
          else if (year >= 2) {
            const monologMachines = Math.ceil(machines * ratio);
            const monologSub = Math.ceil(monologMachines / 120) * PRICES.monolog.subscription;
            yearData.moai.subscription = monologSub * PRICES.moai.subscriptionMultiplier;
            
            const monolisUsers = Math.ceil(users * ratio);
            yearData.monolis.subscription = monolisUsers * PRICES.monolis.subscription;
          }
        }

        // ì´ì•¡ ê³„ì‚°
        yearData.total = 
          yearData.monolog.installation + yearData.monolog.subscription +
          yearData.monolis.installation + yearData.monolis.subscription +
          yearData.moai.installation + yearData.moai.subscription +
          yearData.poc;

        result.years.push(yearData);
      }
      return result;
    }

    // ê²°ê³¼ í‘œì‹œ (ìƒˆë¡œìš´ í˜•ì‹)
    function displayResult(result, companyName) {
      let html = `
        <h2>${companyName} ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</h2>
        <table class="comparison-table">
          <tr>
            <th rowspan="2">ë‹¨ê³„</th>
            <th rowspan="2">ì—°ë„</th>
            <th colspan="2">Monolog</th>
            <th colspan="2">Monolis</th>
            <th colspan="2">MoAI</th>
            <th rowspan="2">PoC ì§„í–‰ë¹„</th>
            <th rowspan="2">ì´ ë§¤ì¶œ</th>
          </tr>
          <tr>
            <th>ì„¤ì¹˜ë¹„</th>
            <th>êµ¬ë…ë£Œ</th>
            <th>ì„¤ì¹˜ë¹„</th>
            <th>êµ¬ë…ë£Œ</th>
            <th>ì„¤ì¹˜ë¹„</th>
            <th>êµ¬ë…ë£Œ</th>
          </tr>
      `;

      result.years.forEach(yearData => {
        html += `
          <tr>
            <td>${yearData.phase}</td>
            <td>${yearData.year}ë…„ì°¨</td>
            <td>${formatCurrency(yearData.monolog.installation)}</td>
            <td>${formatCurrency(yearData.monolog.subscription)}</td>
            <td>${formatCurrency(yearData.monolis.installation)}</td>
            <td>${formatCurrency(yearData.monolis.subscription)}</td>
            <td>${formatCurrency(yearData.moai.installation)}</td>
            <td>${formatCurrency(yearData.moai.subscription)}</td>
            <td>${formatCurrency(yearData.poc)}</td>
            <td class="highlight">${formatCurrency(yearData.total)}</td>
          </tr>
        `;
      });

      html += `</table>`;
      document.getElementById("result").innerHTML = html;
    }

    // ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
    function simulateDetails() {
      const companyName = document.getElementById("companyName").value.trim();
      const companyType = document.getElementById("companyType").value;
      const machines = parseInt(document.getElementById("machines").value) || 0;
      const users = parseInt(document.getElementById("users").value) || 0;

      if (!companyName || !companyType) {
        alert("íšŒì‚¬ëª…ê³¼ íšŒì‚¬ êµ¬ë¶„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const result = calculateSubscription(companyType, machines, users);
      currentSimulation = {
        companyName,
        companyType,
        machines,
        users,
        result
      };
      displayResult(result, companyName);
    }

    // ì‹œë®¬ë ˆì´ì…˜ ì €ì¥
    function saveSimulation() {
      if (!currentSimulation) {
        alert("ë¨¼ì € ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ì¤‘ë³µ í™•ì¸
      const existsIndex = savedSimulations.findIndex(sim => 
        sim.companyName === currentSimulation.companyName && 
        sim.companyType === currentSimulation.companyType
      );

      if (existsIndex >= 0) {
        if (!confirm("ë™ì¼í•œ íšŒì‚¬ëª…ê³¼ ìœ í˜•ì˜ ì‹œë®¬ë ˆì´ì…˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        savedSimulations[existsIndex] = currentSimulation;
      } else {
        savedSimulations.push(currentSimulation);
      }

      localStorage.setItem('sijeSimulations', JSON.stringify(savedSimulations));
      updateSavedSimulationsList();
      updateCompareSelect();
      alert("ì‹œë®¬ë ˆì´ì…˜ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // ì €ì¥ëœ ì‹œë®¬ë ˆì´ì…˜ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updateSavedSimulationsList() {
      savedSimulationsList.innerHTML = savedSimulations.length ? 
        savedSimulations.map((sim, index) => `
          <li>
            <strong>${sim.companyName}</strong> (${getCompanyTypeName(sim.companyType)})
            - ê¸°ê³„: ${sim.machines}ëŒ€, ì‚¬ìš©ì: ${sim.users}ëª…
            <button onclick="loadSimulation(${index})">ë³´ê¸°</button>
            <button onclick="deleteSimulation(${index})">ì‚­ì œ</button>
          </li>
        `).join('') : '<li>ì €ì¥ëœ ì‹œë®¬ë ˆì´ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
    }

    // ë¹„êµ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateCompareSelect() {
      compareSelect.innerHTML = savedSimulations.map((sim, index) => 
        `<option value="${index}">${sim.companyName} (${getCompanyTypeName(sim.companyType)})</option>`
      ).join('');
    }

    // íšŒì‚¬ ìœ í˜• ì´ë¦„
    function getCompanyTypeName(type) {
      return {
        production: 'ìƒì‚° ì¤‘ì‹¬',
        sourcing: 'ì†Œì‹± ì¤‘ì‹¬',
        data: 'ë°ì´í„° ì¤‘ì‹¬'
      }[type] || type;
    }

    // ì‹œë®¬ë ˆì´ì…˜ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadSimulation(index) {
      if (index >= 0 && index < savedSimulations.length) {
        currentSimulation = savedSimulations[index];
        document.getElementById("companyName").value = currentSimulation.companyName;
        document.getElementById("companyType").value = currentSimulation.companyType;
        document.getElementById("machines").value = currentSimulation.machines;
        document.getElementById("users").value = currentSimulation.users;
        displayResult(currentSimulation.result, currentSimulation.companyName);
      }
    }

    // ì‹œë®¬ë ˆì´ì…˜ ì‚­ì œ
    function deleteSimulation(index) {
      if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        savedSimulations.splice(index, 1);
        localStorage.setItem('sijeSimulations', JSON.stringify(savedSimulations));
        updateSavedSimulationsList();
        updateCompareSelect();
      }
    }

    // ë¹„êµ ë¶„ì„ ì‹¤í–‰
    function showComparison() {
      const selected = Array.from(compareSelect.selectedOptions).map(opt => parseInt(opt.value));
      
      if (selected.length < 2) {
        alert("ìµœì†Œ 2ê°œ ì´ìƒì˜ ì‹œë®¬ë ˆì´ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      const selectedSimulations = selected.map(index => savedSimulations[index]);
      renderComparison(selectedSimulations);
    }

    // ë¹„êµ ê²°ê³¼ ë Œë”ë§
    function renderComparison(simulations) {
      // í…Œì´ë¸” ìƒì„±
      let html = `
        <h3>ë¹„êµ ë¶„ì„ ê²°ê³¼</h3>
        <table class="comparison-table">
          <tr>
            <th rowspan="2">íšŒì‚¬ëª…</th>
            <th rowspan="2">ìœ í˜•</th>
            ${simulations[0].result.years.map(year => `
              <th colspan="2">${year.year}ë…„ì°¨ (${year.phase})</th>
            `).join('')}
            <th rowspan="2">ì´í•©ê³„</th>
          </tr>
          <tr>
            ${simulations[0].result.years.map(() => `
              <th>ë§¤ì¶œ</th>
              <th>êµ¬ë…ë£Œ</th>
            `).join('')}
          </tr>
      `;

      simulations.forEach(sim => {
        const total = sim.result.years.reduce((sum, year) => sum + year.total, 0);
        html += `
          <tr>
            <td>${sim.companyName}</td>
            <td>${getCompanyTypeName(sim.companyType)}</td>
            ${sim.result.years.map(year => `
              <td>${formatCurrency(year.total)}</td>
              <td>${formatCurrency(
                year.monolog.subscription + 
                year.monolis.subscription + 
                year.moai.subscription
              )}</td>
            `).join('')}
            <td class="highlight">${formatCurrency(total)}</td>
          </tr>
        `;
      });

      html += `</table>`;
      document.getElementById("comparisonResult").innerHTML = html;

      // ì°¨íŠ¸ ìƒì„±
      renderComparisonChart(simulations);
    }

    // ë¹„êµ ì°¨íŠ¸ ìƒì„±
    function renderComparisonChart(simulations) {
      const ctx = document.getElementById('comparisonChart').getContext('2d');
      
      if (comparisonChart) {
        comparisonChart.destroy();
      }

      const labels = simulations.map(sim => 
        `${sim.companyName} (${getCompanyTypeName(sim.companyType)})`
      );

      const yearData = simulations[0].result.years.map((_, yearIndex) => ({
        label: `${yearIndex + 1}ë…„ì°¨`,
        data: simulations.map(sim => sim.result.years[yearIndex].total)
      }));

      comparisonChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: yearData.map((year, i) => ({
            label: year.label,
            data: year.data,
            backgroundColor: `hsl(${i * 90}, 70%, 50%)`,
            borderColor: `hsl(${i * 90}, 70%, 30%)`,
            borderWidth: 1
          }))
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'ê¸ˆì•¡ ($)' }
            },
            x: {
              title: { display: true, text: 'íšŒì‚¬ëª…' }
            }
          }
        }
      });
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIJE 구독료 계산기</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Pretendard Variable', sans-serif;
      max-width: 1400px;
      margin: 20px auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 40px;
      border: 1px solid #ccc;
    }
    .flex-row {
      display: flex;
      gap: 40px;
    }
    .form-section {
      flex: 1;
    }
    .result {
      flex: 2;
      background: #f9f9f9;
      padding: 10px;
      border: 1px solid #ddd;
      overflow-x: auto;
    }
    label { display: block; margin-top: 10px; }
    input[type="text"], input[type="number"], select { width: 100%; padding: 4px; margin-top: 4px; }
    .saved-list { margin-top: 10px; font-size: 0.9em; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
    th { background-color: #f0f0f0; }
    .highlight { background-color: #e3f7d9; font-weight: bold; }
    canvas { margin-top: 20px; }
    .remark-box {
      background: #fffdf0;
      border: 1px dashed #bbb;
      padding: 10px;
      font-size: 0.9em;
      line-height: 1.6em;
    }
    .remark-details {
      margin-top: 8px;
      font-size: 0.85em;
      color: #444;
    }
    .remark-details ul {
      margin-top: 5px;
      padding-left: 18px;
    }
    .remark-details li {
      margin-bottom: 4px;
    }
    .service-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 0.85em;
    }
    .service-table th, .service-table td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
    }
    .service-table th {
      background-color: #f5f5f5;
    }
    button {
      padding: 8px 16px;
      margin-top: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <div class="flex-row">
    <div class="form-section">
      <h1>SIJE 구독료 계산기</h1>
      <label>회사명
        <input type="text" id="companyName" placeholder="회사명을 입력하세요">
      </label>
      <label>회사 구분
        <select id="companyType">
          <option value="">선택</option>
          <option value="production">생산 중심</option>
          <option value="sourcing">소싱 중심</option>
          <option value="data">데이터 중심</option>
        </select>
      </label>
      <label>재봉틀 수
        <input type="number" id="machines" value="0">
      </label>
      <label>사용자 수 (Monolis)
        <input type="number" id="users" value="0">
      </label>
      <button id="simulateBtn">상세 시뮬레이션</button>
      <button id="saveBtn">시뮬레이션 저장</button>

      <div class="saved-list">
        <h4>📂 저장된 시뮬레이션 보기</h4>
        <ul id="savedSimulations"></ul>
      </div>

      <div class="remark-box">
        <strong>📌 Remark</strong><br>
        계산 기준과 적용 비율에 대한 설명입니다.
        <div class="remark-details">
          <ul>
            <li><strong>Acquire</strong>: 전체 대상(기계 수 또는 사용자 수)의 <strong>5%</strong>만 적용됩니다. 데모 단계이며, 설치비가 포함될 수 있습니다.</li>
            <li><strong>Expand</strong>: 전체 대상의 <strong>20%</strong>가 적용됩니다. 일부 공장 및 사용자에 대해 정식 계약이 시작되는 단계입니다.</li>
            <li><strong>Standardize</strong>: 전체 대상의 <strong>70%</strong>까지 확대 적용됩니다. 전사 시스템 표준화 단계입니다.</li>
            <li><strong>Monolog</strong>: 기계 수 기준. 120대당 구독료가 산정됩니다. 최초 도입 시 설치비가 발생합니다.</li>
            <li><strong>MoAI</strong>: Monolog 기반 AI 서비스로, Monolog 구독료의 2배로 책정됩니다.</li>
            <li><strong>Monolis</strong>: 사용자 수 기준. 1인당 월 구독료가 적용됩니다.</li>
          </ul>
          <strong>💡 서비스 도입 단계별 구성 (회사 유형별)</strong>
          <table class="service-table">
            <tr>
              <th>연도</th>
              <th>생산 중심</th>
              <th>소싱 중심</th>
              <th>데이터 중심</th>
            </tr>
            <tr>
              <td>1년차 (Acquire)</td>
              <td>Monolog</td>
              <td>Monolis</td>
              <td>MoAI</td>
            </tr>
            <tr>
              <td>2년차 (Expand)</td>
              <td>Monolog + MoAI</td>
              <td>Monolog + MoAI + Monolis</td>
              <td>MoAI + Monolis</td>
            </tr>
            <tr>
              <td>3년차 (Expand)</td>
              <td>Monolog + MoAI + Monolis</td>
              <td>Monolog + MoAI + Monolis</td>
              <td>MoAI + Monolis</td>
            </tr>
            <tr>
              <td>4년차 (Standardize)</td>
              <td>Monolog + MoAI + Monolis</td>
              <td>Monolog + MoAI + Monolis</td>
              <td>MoAI + Monolis</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <div class="result" id="result"></div>
  </div>

  <div class="result">
    <h2>비교 분석</h2>
    <label>비교할 회사 선택 (복수 가능)
      <select id="compareSelect" multiple style="height: 100px; width: 100%;"></select>
    </label>
    <button onclick="showComparison()">비교 분석 실행</button>
    <div id="comparisonResult"></div>
    <canvas id="userChart" width="600" height="300"></canvas>
  </div>

  <script>
    // 저장된 시뮬레이션 데이터
    let savedSimulations = JSON.parse(localStorage.getItem('sijeSimulations')) || [];
    let currentSimulation = null;
    
    // DOM 요소 가져오기
    const simulateBtn = document.getElementById("simulateBtn");
    const saveBtn = document.getElementById("saveBtn");
    const savedSimulationsList = document.getElementById("savedSimulations");
    const compareSelect = document.getElementById("compareSelect");
    
    // 이벤트 리스너 등록
    simulateBtn.addEventListener("click", simulateDetails);
    saveBtn.addEventListener("click", saveSimulation);
    
    // 페이지 로드 시 저장된 시뮬레이션 목록 업데이트
    updateSavedSimulationsList();
    
    // 상세 시뮬레이션 함수
    function simulateDetails() {
      const companyName = document.getElementById("companyName").value;
      const companyType = document.getElementById("companyType").value;
      const machines = parseInt(document.getElementById("machines").value) || 0;
      const users = parseInt(document.getElementById("users").value) || 0;
      
      if (!companyName || !companyType) {
        alert("회사명과 회사 구분을 입력해주세요.");
        return;
      }
      
      // 계산 수행
      const result = calculateSubscription(companyType, machines, users);
      currentSimulation = {
        companyName,
        companyType,
        machines,
        users,
        result
      };
      
      // 결과 표시
      displayResult(result, companyName);
    }
    
    // 구독료 계산 함수
    function calculateSubscription(companyType, machines, users) {
      const MONOLOG_UNIT_PRICE = 1200000; // 120대당 월 구독료
      const MONOLIS_PRICE = 50000; // 1인당 월 구독료
      const INSTALLATION_FEE = 5000000; // 설치비
      
      const result = {
        years: []
      };
      
      for (let year = 1; year <= 4; year++) {
        let yearData = {
          year,
          monolog: 0,
          moai: 0,
          monolis: 0,
          installation: 0,
          total: 0
        };
        
        // 적용 비율 계산
        let applyRatio = 0;
        if (year === 1) applyRatio = 0.05; // Acquire (5%)
        else if (year === 2 || year === 3) applyRatio = 0.2; // Expand (20%)
        else if (year === 4) applyRatio = 0.7; // Standardize (70%)
        
        // 회사 유형별 서비스 구성
        if (companyType === "production") {
          // 생산 중심
          if (year === 1) {
            // Monolog만
            yearData.monolog = Math.ceil(machines * applyRatio / 120) * MONOLOG_UNIT_PRICE;
            yearData.installation = INSTALLATION_FEE;
          } else if (year === 2) {
            // Monolog + MoAI
            yearData.monolog = Math.ceil(machines * applyRatio / 120) * MONOLOG_UNIT_PRICE;
            yearData.moai = yearData.monolog * 2;
          } else if (year >= 3) {
            // Monolog + MoAI + Monolis
            yearData.monolog = Math.ceil(machines * applyRatio / 120) * MONOLOG_UNIT_PRICE;
            yearData.moai = yearData.monolog * 2;
            yearData.monolis = Math.ceil(users * applyRatio) * MONOLIS_PRICE;
          }
        } else if (companyType === "sourcing") {
          // 소싱 중심
          if (year === 1) {
            // Monolis만
            yearData.monolis = Math.ceil(users * applyRatio) * MONOLIS_PRICE;
          } else if (year >= 2) {
            // Monolog + MoAI + Monolis
            yearData.monolog = Math.ceil(machines * applyRatio / 120) * MONOLOG_UNIT_PRICE;
            if (year === 2) yearData.installation = INSTALLATION_FEE;
            yearData.moai = yearData.monolog * 2;
            yearData.monolis = Math.ceil(users * applyRatio) * MONOLIS_PRICE;
          }
        } else if (companyType === "data") {
          // 데이터 중심
          if (year === 1) {
            // MoAI만 (Monolog 기반)
            const monologBase = Math.ceil(machines * applyRatio / 120) * MONOLOG_UNIT_PRICE;
            yearData.moai = monologBase * 2;
            yearData.installation = INSTALLATION_FEE;
          } else if (year >= 2) {
            // MoAI + Monolis
            const monologBase = Math.ceil(machines * applyRatio / 120) * MONOLOG_UNIT_PRICE;
            yearData.moai = monologBase * 2;
            yearData.monolis = Math.ceil(users * applyRatio) * MONOLIS_PRICE;
          }
        }
        
        // 총액 계산
        yearData.total = yearData.monolog + yearData.moai + yearData.monolis + yearData.installation;
        result.years.push(yearData);
      }
      
      return result;
    }
    
    // 결과 표시 함수
    function displayResult(result, companyName) {
      let html = `<h2>${companyName} 시뮬레이션 결과</h2>`;
      html += `<table>
        <tr>
          <th>연도</th>
          <th>Monolog</th>
          <th>MoAI</th>
          <th>Monolis</th>
          <th>설치비</th>
          <th class="highlight">총액</th>
        </tr>`;
      
      result.years.forEach(yearData => {
        html += `<tr>
          <td>${yearData.year}년차</td>
          <td>${formatCurrency(yearData.monolog)}</td>
          <td>${formatCurrency(yearData.moai)}</td>
          <td>${formatCurrency(yearData.monolis)}</td>
          <td>${formatCurrency(yearData.installation)}</td>
          <td class="highlight">${formatCurrency(yearData.total)}</td>
        </tr>`;
      });
      
      html += `</table>`;
      document.getElementById("result").innerHTML = html;
    }
    
    // 통화 형식으로 변환
    function formatCurrency(amount) {
      return amount ? amount.toLocaleString('ko-KR') + '원' : '-';
    }
    
    // 시뮬레이션 저장 함수
    function saveSimulation() {
      if (!currentSimulation) {
        alert("먼저 시뮬레이션을 실행해주세요.");
        return;
      }
      
      // 중복 확인
      const exists = savedSimulations.some(sim => 
        sim.companyName === currentSimulation.companyName && 
        sim.companyType === currentSimulation.companyType
      );
      
      if (exists) {
        alert("이미 동일한 회사명과 유형의 시뮬레이션이 저장되어 있습니다.");
        return;
      }
      
      savedSimulations.push(currentSimulation);
      localStorage.setItem('sijeSimulations', JSON.stringify(savedSimulations));
      updateSavedSimulationsList();
      updateCompareSelect();
      alert("시뮬레이션이 저장되었습니다.");
    }
    
    // 저장된 시뮬레이션 목록 업데이트
    function updateSavedSimulationsList() {
      savedSimulationsList.innerHTML = '';
      
      if (savedSimulations.length === 0) {
        savedSimulationsList.innerHTML = '<li>저장된 시뮬레이션이 없습니다.</li>';
        return;
      }
      
      savedSimulations.forEach((sim, index) => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${sim.companyName}</strong> (${getCompanyTypeName(sim.companyType)}) 
          - 기계: ${sim.machines}대, 사용자: ${sim.users}명 
          <button onclick="loadSimulation(${index})">보기</button>
          <button onclick="deleteSimulation(${index})">삭제</button>`;
        savedSimulationsList.appendChild(li);
      });
    }
    
    // 비교 선택 옵션 업데이트
    function updateCompareSelect() {
      compareSelect.innerHTML = '';
      
      savedSimulations.forEach((sim, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${sim.companyName} (${getCompanyTypeName(sim.companyType)})`;
        compareSelect.appendChild(option);
      });
    }
    
    // 회사 유형 이름 가져오기
    function getCompanyTypeName(type) {
      switch(type) {
        case 'production': return '생산 중심';
        case 'sourcing': return '소싱 중심';
        case 'data': return '데이터 중심';
        default: return type;
      }
    }
    
    // 시뮬레이션 로드
    function loadSimulation(index) {
      if (index >= 0 && index < savedSimulations.length) {
        currentSimulation = savedSimulations[index];
        document.getElementById("companyName").value = currentSimulation.companyName;
        document.getElementById("companyType").value = currentSimulation.companyType;
        document.getElementById("machines").value = currentSimulation.machines;
        document.getElementById("users").value = currentSimulation.users;
        displayResult(currentSimulation.result, currentSimulation.companyName);
      }
    }
    
    // 시뮬레이션 삭제
    function deleteSimulation(index) {
      if (confirm("정말 이 시뮬레이션을 삭제하시겠습니까?")) {
        savedSimulations.splice(index, 1);
        localStorage.setItem('sijeSimulations', JSON.stringify(savedSimulations));
        updateSavedSimulationsList();
        updateCompareSelect();
      }
    }
    
    // 비교 분석 실행
    function showComparison() {
      const selectedIndices = Array.from(compareSelect.selectedOptions).map(opt => parseInt(opt.value));
      
      if (selectedIndices.length < 2) {
        alert("비교를 위해 최소 2개 이상의 시뮬레이션을 선택해주세요.");
        return;
      }
      
      const selectedSimulations = selectedIndices.map(index => savedSimulations[index]);
      displayComparison(selectedSimulations);
    }
    
    // 비교 결과 표시
    function displayComparison(simulations) {
      let html = `<h3>비교 분석 결과</h3><table><tr><th>회사명</th>`;
      
      // 테이블 헤더 생성 (연도별)
      for (let year = 1; year <= 4; year++) {
        html += `<th>${year}년차 총액</th>`;
      }
      html += `</tr>`;
      
      // 각 시뮬레이션 데이터 행 추가
      simulations.forEach(sim => {
        html += `<tr><td>${sim.companyName}</td>`;
        sim.result.years.forEach(yearData => {
          html += `<td>${formatCurrency(yearData.total)}</td>`;
        });
        html += `</tr>`;
      });
      
      html += `</table>`;
      document.getElementById("comparisonResult").innerHTML = html;
      
      // 차트 생성
      createComparisonChart(simulations);
    }
    
    // 비교 차트 생성
    function createComparisonChart(simulations) {
      const ctx = document.getElementById('userChart').getContext('2d');
      
      // 기존 차트가 있으면 제거
      if (window.comparisonChart) {
        window.comparisonChart.destroy();
      }
      
      const labels = simulations.map(sim => sim.companyName);
      const datasets = [];
      
      // 연도별 데이터셋 생성
      for (let year = 1; year <= 4; year++) {
        datasets.push({
          label: `${year}년차`,
          data: simulations.map(sim => sim.result.years[year-1].total),
          backgroundColor: getRandomColor(),
          borderColor: getRandomColor(),
          borderWidth: 1
        });
      }
      
      window.comparisonChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '구독료 (원)'
              }
            },
            x: {
              title: {
                display: true,
                text: '회사명'
              }
            }
          }
        }
      });
    }
    
    // 랜덤 색상 생성
    function getRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }
  </script>
</body>
</html>
